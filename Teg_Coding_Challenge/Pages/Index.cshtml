@page

@{
    ViewData["Title"] = "TEG Home";
}
<link href="/lib/calendar/main.css" rel="stylesheet" />
<script src="/lib/calendar/main.js"></script>
<!-- Include jQuery from a CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Include Bootstrap CSS and JavaScript from a CDN -->
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {

        var calendarEl = document.getElementById('calendar');       
        var d = new Date();
        var month = d.getMonth() + 1;
        var day = d.getDate();
        var output = d.getFullYear() + '-' +
            (('' + month).length < 2 ? '0' : '') + month + '-' +
            (('' + day).length < 2 ? '0' : '') + day;


        var calendar = new FullCalendar.Calendar(calendarEl, {
            headerToolbar: {
                left: 'prev',
                center: 'title',
                right: 'next',
            },
            initialDate: output,
            navLinks: true,
            selectable: true,
            selectMirror: true,
            select: function (arg) {

            },
            events: function (fetchInfo, successCallback, failureCallback) {

                $.ajax({
                    url: '/api/TegEvents',
                    type: 'GET',
                    dataType: 'json',
                    beforeSend: function () {
                        $('#divLoder').show();
                    },
                    success: function (data) {
                        $('#divLoder').hide();

                        var events = data.events.map(function (event) {
                            return {
                                id: event.id,
                                title: event.name,
                                start: event.startDate,
                                description: event.description,
                                venueId: event.venueId
                            };
                        });
                        $('#divLoder').hide();
                        successCallback(events);
                    },
                    error: function (xhr, status, error) {
                        $('#divAlert').html(xhr.responseText);
                        $('#divAlert').show();
                        $('#divLoder').hide();
                       
                        failureCallback(error);
                    }
                });
            },
            eventDrop: function (args) {

            },
            eventClick: function (arg) {
                if (arg.event.id > 0) {
                    console.log(arg.event);
                    console.log(arg.event.id);
                    console.log(arg.event.title);
                    console.log(arg.event._def.extendedProps.description);
                    console.log(arg.event._def.extendedProps.venueId);
                    console.log(arg.event.start);

                    //fetching venue details
                    $.ajax({
                        url: '/api/TegEvents/' + arg.event._def.extendedProps.venueId,
                        type: 'GET',
                        dataType: 'json',
                        beforeSend: function () {
                            $('#divLoder').show();
                        },
                        success: function (data) {
                            $('#divLoder').hide();
                            console.log(data);
                            $("#lblEventAddress").text(data.name);
                            $("#lblEventLocation").text(data.location);
                        },
                        error: function (xhr, status, error) {

                        }
                    });

                    const formattedDate = formatDate(arg.event.start);
                    $('#TegDetailsPopup').modal('show');
                    $("#lbleventName").html("<b>" + arg.event.title + "</b><br>");
                    $("#lblEventDate").text("Event Date :" + formattedDate);

                }
            },
            editable: true,
            dayMaxEvents: true,
            //events: getEvents(),
        });
        calendar.render();
    });

    function ClosePopup() {
        $('#TegDetailsPopup').modal('hide');
    }

    function formatDate(date) {
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0'); // Adding 1 to month since it's zero-based
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

</script>

<div class="text-center">
    <div id="calendar-container" style="max-width: 800px; margin: 0 auto;">
        <div id="divLoader" style="display:none;">
            <img width="81px" height="60" src="~/images/loader_.gif">
        </div>
        <div id="divAlert" class="alert-danger" style="display:none"></div>
        <div>
            <h2>Whats new on TEG's Stadium !' </h2>
        </div>
        <div id="calendar"></div>
    </div>
</div>


<!--TEG detail show  Popup -->
<div class="modal" id="TegDetailsPopup" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
          
            <div class="modal-header">
                <h4 class="modal-title">Teg Event</h4>
            </div>
            <!-- Modal body -->
            <div id="divEventText" class="modal-body">
                <label id="lbleventName"></label><br />
                <label id="lblEventDate"></label><br />
                <label id="lblEventAddress"></label><br />
                <label id="lblEventLocation"></label>
            </div>
            <div class="modal-footer">
                <button onclick="ClosePopup();" type="button" class="btn btn-success" data-dismiss="modal">Ok</button>
            </div>
        </div>
    </div>
</div>

